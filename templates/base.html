{#
Copyright (c) 2026 Dmitry Arkhipov (grisumbras@yandex.ru)

Distributed under the Boost Software License, Version 1.0. (See accompanying
file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
#}

{%- macro coverage_hint(kind) -%}
    {%- if kind == 'UNC' -%}
        Uncovered New Code (+ => 0):
Newly added code is not tested
    {%- elif kind == 'LBC' -%}
        Lost Baseline Coverage (1 => 0):
Unchanged code is no longer tested
    {%- elif kind == 'UIC' -%}
        Uncovered Included Code (# => 0):
Previously unused code is untested
    {%- elif kind == 'UBC' -%}
        Uncovered Baseline Code (0 => 0):
Unchanged code was untested before, is untested now
    {%- elif kind == 'GBC' -%}
        Gained Baseline Coverage (0 => 1):
Unchanged code is tested now
    {%- elif kind == 'GIC' -%}
        Gained Included Coverage (# => 1):
Previously unused code is tested now
    {%- elif kind == 'GNC' -%}
        Gained New Coverage (+ => 1):
Newly added code is tested
    {%- elif kind == 'CBC' -%}
        Covered Baseline Code (1 => 1):
Unchanged code was tested before and is still tested
    {%- elif kind == 'EUB' -%}
        Excluded Uncovered Baseline (0 => #):
Previously untested code is unused now
    {%- elif kind == 'ECB' -%}
        Excluded Covered Baseline (1 => #):
Previously tested code is unused now
    {%- elif kind == 'DUB' -%}
        Deleted Uncovered Baseline (0 => -):
Previously untested code has been deleted
    {%- elif kind == 'DCB' -%}
        Deleted Covered Baseline (1 => -):
Previously tested code has been deleted
    {%- endif -%}
{%- endmacro -%}

{%- macro coverage_kind(kind, data=kind) -%}
<t{{ 'h' if data == kind else 'd' }} class="coverage-kind coverage-{{kind if data else ''}}"
  {%- if kind and data %} title="{{ coverage_hint(kind) }}"{% endif %}>
  {{ data }}
</t{{ 'h' if data == kind else 'd' }}>
{% endmacro -%}

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta class="meta-theme" name="theme-color" content="#FAFAFA" data-dark="#18181B" data-light="#FAFAFA">
    <meta class="meta-theme" name="color-scheme" content="light" data-dark="dark" data-light="light">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">

    <title>Diff coverage for {{ file.source_path }}</title>
    <link type="text/css" rel="stylesheet" href="{{ file.stylesheet }}"/>
    <style>
        body {
            background: var(--surface-background-main-base-primary, #fff);
        }
        #user-settings { float: right; clear: both; }
        #header { max-width: var(--main-content-width); }
        #header h1 { margin-right: 2rem; }
        #header i { color: var(--text-main-text-body-primary, #2a2c30); }
        .boostlook main { margin-top: 1.5rem; }
        .boostlook #content table.tableblock.coverage-summary { min-width: 50%; }
        .boostlook #content table.tableblock.coverage-summary thead th { text-align: center; }
        .boostlook #content table.tableblock.coverage-summary tbody th { text-align: right; }
        .boostlook #content table.tableblock.coverage-summary td { text-align: center; }
        .basic-coverage .boostlook #content table.tableblock tr.row-coverage-advanced { display:none; }
        .advanced-coverage .boostlook #content table.tableblock tr.row-coverage-basic { display:none; }

        .boostlook .line-comparison { border-spacing: 0; }
        .boostlook .line-comparison td, .boostlook .line-comparison pre,
        .boostlook .line-comparison th {
          padding: 0;
          margin: 0;
          border: 0;
        }
        .boostlook .line-comparison th {
          padding-left: var(--spacing-size-2xs);
          padding-right: var(--spacing-size-4xs);
        }
        .boostlook .line-comparison .coverage-kind {
          min-width: 2rem;
          padding-right: var(--spacing-size-2xs);
        }
        .boostlook .line-comparison .diff-action {
          min-width: var(--spacing-size-xs);
          font-family: var(--font-family-code);
          text-align: center;
        }
        .boostlook .line-comparison .diff-action.diff-modify {
          background-color: var(--colors-code-colors-yellow);
        }
        .boostlook .line-comparison .diff-action.diff-add {
          background-color: var(--colors-code-colors-green);
        }
        .boostlook .line-comparison .diff-action.diff-remove {
          background-color: var(--colors-code-colors-red);
        }
        .boostlook .line-comparison th a { color: var(--text-main-text-primary); }
        .boostlook table.line-comparison { font-size: var(--font-size-xs); }
        .boostlook .line-comparison .coverage-none {
          color: var(--colors-neutral-500);
        }
        .advanced-coverage .boostlook .line-comparison .coverage-UNC pre,
        .advanced-coverage .boostlook .line-comparison .coverage-UNC th.coverage-kind,
        .boostlook .coverage-summary  .coverage-kind.coverage-UNC {
          background-color: var(--colors-negative-600) !important;
        }
        .advanced-coverage .boostlook .line-comparison .coverage-LBC pre,
        .advanced-coverage .boostlook .line-comparison .coverage-LBC th.coverage-kind,
        .boostlook .coverage-summary  .coverage-kind.coverage-LBC {
          background-color: var(--colors-negative-500) !important;
        }
        .advanced-coverage .boostlook .line-comparison .coverage-UIC pre,
        .advanced-coverage .boostlook .line-comparison .coverage-UIC th.coverage-kind,
        .boostlook .coverage-summary  .coverage-kind.coverage-UIC {
          background-color: var(--colors-negative-400) !important;
        }
        .advanced-coverage .boostlook .line-comparison .coverage-UBC pre,
        .advanced-coverage .boostlook .line-comparison .coverage-UBC th.coverage-kind,
        .boostlook .coverage-summary  .coverage-kind.coverage-UBC {
          background-color: var(--colors-warning-400) !important;
        }
        .advanced-coverage .boostlook .line-comparison .coverage-GBC pre,
        .advanced-coverage .boostlook .line-comparison .coverage-GBC th.coverage-kind,
        .boostlook .coverage-summary  .coverage-kind.coverage-GBC {
          background-color: var(--colors-positive-700) !important;
        }
        .advanced-coverage .boostlook .line-comparison .coverage-GIC pre,
        .advanced-coverage .boostlook .line-comparison .coverage-GIC th.coverage-kind,
        .boostlook .coverage-summary  .coverage-kind.coverage-GIC {
          background-color: var(--colors-positive-600) !important;
        }
        .advanced-coverage .boostlook .line-comparison .coverage-GNC pre,
        .advanced-coverage .boostlook .line-comparison .coverage-GNC th.coverage-kind,
        .boostlook .coverage-summary  .coverage-kind.coverage-GNC {
          background-color: var(--colors-positive-500) !important;
        }
        .advanced-coverage .boostlook .line-comparison .coverage-CBC pre,
        .advanced-coverage .boostlook .line-comparison .coverage-CBC th.coverage-kind,
        .boostlook .coverage-summary  .coverage-kind.coverage-CBC {
          background-color: var(--colors-positive-400) !important;
        }
        .advanced-coverage .boostlook .line-comparison .coverage-EUB pre,
        .advanced-coverage .boostlook .line-comparison .coverage-EUB th.coverage-kind,
        .boostlook .coverage-summary  .coverage-kind.coverage-EUB {
          background-color: var(--colors-blue-600) !important;
        }
        .advanced-coverage .boostlook .line-comparison .coverage-ECB pre,
        .advanced-coverage .boostlook .line-comparison .coverage-ECB th.coverage-kind,
        .boostlook .coverage-summary  .coverage-kind.coverage-ECB {
          background-color: var(--colors-code-colors-purple) !important;
        }
        .advanced-coverage .boostlook .line-comparison .coverage-DUB pre,
        .advanced-coverage .boostlook .line-comparison .coverage-DUB th.coverage-kind,
        .boostlook .coverage-summary  .coverage-kind.coverage-DUB {
          background-color: var(--colors-blue-400) !important;
        }
        .advanced-coverage .boostlook .line-comparison .coverage-DCB pre,
        .advanced-coverage .boostlook .line-comparison .coverage-DCB th.coverage-kind,
        .boostlook .coverage-summary  .coverage-kind.coverage-DCB {
          background-color: var(--colors-code-colors-turquoise) !important;
        }
        .boostlook .coverage-summary .coverage-kind.coverage-hit {
          background-color: var(--colors-positive-400) !important;
        }
        .boostlook .coverage-summary .coverage-kind.coverage-hit-new {
          background-color: var(--colors-positive-600) !important;
        }
        .boostlook .coverage-summary .coverage-kind.coverage-miss {
          background-color: var(--colors-negative-400) !important;
        }
        .boostlook .coverage-summary .coverage-kind.coverage-miss-new {
          background-color: var(--colors-negative-600) !important;
        }
        .basic-coverage .boostlook .line-comparison .coverage-UNC pre,
        .basic-coverage .boostlook .line-comparison .coverage-UNC th.coverage-kind,
        .basic-coverage .boostlook .line-comparison .coverage-LBC pre,
        .basic-coverage .boostlook .line-comparison .coverage-LBC th.coverage-kind,
        .basic-coverage .boostlook .line-comparison .coverage-UIC pre,
        .basic-coverage .boostlook .line-comparison .coverage-UIC th.coverage-kind {
          background-color: var(--colors-negative-600) !important;
        }
        .basic-coverage .boostlook .line-comparison .coverage-UBC pre,
        .basic-coverage .boostlook .line-comparison .coverage-UBC th.coverage-kind {
          background-color: var(--colors-negative-400) !important;
        }
        .basic-coverage .boostlook .line-comparison .coverage-GBC pre,
        .basic-coverage .boostlook .line-comparison .coverage-GBC th.coverage-kind,
        .basic-coverage .boostlook .line-comparison .coverage-GIC pre,
        .basic-coverage .boostlook .line-comparison .coverage-GIC th.coverage-kind,
        .basic-coverage .boostlook .line-comparison .coverage-GNC pre,
        .basic-coverage .boostlook .line-comparison .coverage-GNC th.coverage-kind {
          background-color: var(--colors-positive-600) !important;
        }
        .basic-coverage .boostlook .line-comparison .coverage-CBC pre,
        .basic-coverage .boostlook .line-comparison .coverage-CBC th.coverage-kind {
          background-color: var(--colors-positive-400) !important;
        }
      </style>
    </head>
  <body>
    <div class="boostlook"><div id="content">
      <header id="header">
        {% block header %}
        <div id="user-settings">
            <i id="feature-advanced" class="fas fa-magnifying-glass-minus icon-link"
                onclick="toggleAdvanced()" title="Toggle simple/advanced"></i>
            <i id="light-dark" class="fas fa-sun icon-link"
                onclick="changeTheme()" title="Toggle light/dark theme"></i>
        </div>
        <h1>
          Diff coverage report for<br/>
          <nav>
            {% for d in file.ancestors -%}
               <a href="{{ file.relative_path(d) }}">{{ d.basename or '.' }}</a>/
            {%- endfor -%}
            {{ file.basename or '.' }}
          </nav>
        </h1>
        {% endblock %}
      </header>
      <main>
        {% block main %}{% endblock %}
      </main>
    </div></div>
    <script type="text/javascript">
        function changeTheme()
        {
            const storedColorMode = localStorage.getItem("colorMode");
            const browserColorMode = getBrowserColorMode(window);
            let newColorMode = null;
            if (storedColorMode)
            {
                newColorMode = storedColorMode === "dark" ? "light" : "dark";
            }
            else
            {
                newColorMode = browserColorMode === "dark" ? "light" : "dark";
            }
            localStorage.setItem("colorMode", newColorMode);
            updateColorElement(newColorMode)
        }

        function toggleAdvanced()
        {
            const storedMode = localStorage.getItem("advancedCoverage");
            let newMode = "advanced-coverage";
            if (storedMode === "advanced-coverage")
            {
                newMode = "basic-coverage";
            }
            localStorage.setItem("advancedCoverage", newMode);
            updateAdvancedElement(newMode)
        }

        function updateFeatureElement(
            toggleId, val1, class1, val2, class2, newVal)
        {
            const toggleElement = document.getElementById(toggleId)
            const docElement = document.documentElement;
            if (newVal === val1)
            {
                if (toggleElement)
                {
                    toggleElement.classList.remove(class2);
                    toggleElement.classList.add(class1);
                }
                docElement.classList.remove(val2);
            }
            else
            {
                if (toggleElement)
                {
                    toggleElement.classList.remove(class1);
                    toggleElement.classList.add(class2);
                }
                docElement.classList.remove(val1);
            }

            docElement.classList.add(newVal);
        }

        function updateColorElement(colorMode)
        {
            updateFeatureElement(
                "light-dark", "light", "fa-sun", "dark", "fa-moon", colorMode);
        }

        function updateAdvancedElement(mode)
        {
            updateFeatureElement(
                "feature-advanced",
                "advanced-coverage",
                "fa-magnifying-glass-plus",
                "basic-coverage",
                "fa-magnifying-glass-minus",
                mode);
        }

        function getBrowserColorMode(win)
        {
            const prefersDark = win.matchMedia('(prefers-color-scheme: dark)').matches;
            return prefersDark ? "dark" : "light";
        }

        (function()
        {
            const relevantWindow = window.parent || window;
            let browserColorMode = null;
            const userColorMode = localStorage.getItem("colorMode");
            const userAdvancedMode = localStorage.getItem("advancedCoverage");
            if (!relevantWindow.matchMedia)
            {
                browserColorMode = getBrowserColorMode(relevantWindow);
                if (userColorMode === browserColorMode)
                {
                    localStorage.removeItem("colorMode");
                }
            }
            updateColorElement(userColorMode || browserColorMode || "dark");
            updateAdvancedElement(userAdvancedMode || "basic-coverage");
        })();
    </script>
  <body>
<html>
